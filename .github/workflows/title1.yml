name: 商品属性提取

on:
  workflow_dispatch:
    inputs:
      url:
        description: '商品网址'
        required: true

jobs:
  extract:
    runs-on: ubuntu-latest
    
    steps:
      - name: 抓取网页
        run: |
          curl -s "${{ github.event.inputs.url }}" -o page.html
          
      - name: 处理数据
        run: |
          pip install beautifulsoup4 googletrans
          
          # 创建Python脚本文件
          cat > process.py << 'SCRIPT_END'
import json
from bs4 import BeautifulSoup
from googletrans import Translator

# 读取网页
with open('page.html', 'r', encoding='utf-8') as f:
    soup = BeautifulSoup(f, 'html.parser')

# 提取属性表
specs = {}
tables = soup.find_all('table')
for table in tables:
    rows = table.find_all('tr')
    for row in rows:
        cells = row.find_all(['td', 'th'])
        if len(cells) >= 2:
            key = cells[0].get_text(strip=True)
            value = cells[1].get_text(strip=True) if len(cells) > 1 else ''
            if key and value:
                specs[key] = value

print(f"找到属性: {len(specs)} 个")

# 过滤品牌
filtered = {}
for key, value in specs.items():
    if '品牌' in key and '机芯' not in key:
        continue
    filtered[key] = value

# 生成标题
keywords = []
mapping = {'石英':'Quartz','自动':'Automatic','不锈钢':'Stainless Steel'}
for cn, en in mapping.items():
    if cn in ' '.join(filtered.values()):
        keywords.append(en)

title = ' '.join(['Stainless Steel' if 'Stainless Steel' in keywords else '',
                 'Quartz Watch' if 'Quartz' in keywords else 'Watch']).strip()

# 翻译属性
translator = Translator()
translated = {}
for key, value in list(filtered.items())[:10]:
    try:
        en_key = translator.translate(key, dest='en').text
        en_val = translator.translate(value, dest='en').text
        translated[en_key] = en_val
    except:
        translated[key] = value

# 保存结果
result = {
    'title': title,
    'specs_count': len(filtered),
    'translated_specs': translated
}

with open('result.json', 'w', encoding='utf-8') as f:
    json.dump(result, f, ensure_ascii=False, indent=2)

print(f"生成标题: {title}")
SCRIPT_END
          
          python process.py
          
      - name: 输出结果
        run: |
          echo "=== 结果 ==="
          cat result.json
          
      - name: 保存
        uses: actions/upload-artifact@v4
        with:
          name: 商品信息
          path: result.json
