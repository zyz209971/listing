name: 1688å•†å“æŠ“å–ä¸è‡ªåŠ¨ç¿»è¯‘

on:
  workflow_dispatch:
    inputs:
      product_url:
        description: '1688å•†å“ç½‘å€'
        required: true
        default: 'https://detail.1688.com/offer/'
      target_market:
        description: 'ç›®æ ‡å¸‚åœº'
        required: false
        default: 'US'
        type: choice
        options:
          - US
          - EU
          - Global
      min_order_qty:
        description: 'æœ€å°èµ·è®¢é‡ï¼ˆå¦‚æœªæŠ“å–åˆ°ï¼‰'
        required: false
        default: '100'

jobs:
  scrape-and-translate:
    runs-on: ubuntu-latest
    
    steps:
      - name: 1. å¼€å§‹æŠ“å–ä»»åŠ¡
        run: |
          echo "ğŸ”„ å¼€å§‹1688å•†å“æŠ“å–ä¸ç¿»è¯‘"
          echo "å•†å“ç½‘å€: ${{ github.event.inputs.product_url }}"
          echo "ç›®æ ‡å¸‚åœº: ${{ github.event.inputs.target_market }}"
          echo "MOQ: ${{ github.event.inputs.min_order_qty }}"
          
      - name: 2. æ‹‰å–ä»£ç 
        uses: actions/checkout@v3
        
      - name: 3. è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: 4. å®‰è£…ä¾èµ–åŒ…
        run: |
          pip install requests beautifulsoup4
          pip install deep-translator
          pip install python-dotenv
          
      - name: 5. åˆ›å»ºæ™ºèƒ½æŠ“å–è„šæœ¬
        run: |
          cat > smart_scraper.py << 'EOF'
          # è¿™é‡Œæ˜¯ä½ åŸæ¥çš„Pythonè„šæœ¬å†…å®¹ï¼Œä¿æŒä¸å˜...
          # ä¸ºäº†ç®€æ´ï¼Œè¿™é‡Œçœç•¥ä¸­é—´å‡ ç™¾è¡Œä»£ç 
          # ä½ çš„åŸå§‹è„šæœ¬å†…å®¹å®Œå…¨ä¿ç•™
          EOF
          
      - name: 6. è¿è¡ŒæŠ“å–å’Œç¿»è¯‘
        run: |
          echo "ğŸš€ å¼€å§‹æŠ“å–å¹¶ç¿»è¯‘å•†å“ä¿¡æ¯..."
          python smart_scraper.py "${{ github.event.inputs.product_url }}" "${{ github.event.inputs.target_market }}" "${{ github.event.inputs.min_order_qty }}"
          
      - name: 7. æ˜¾ç¤ºæŠ“å–ç»“æœ
        run: |
          echo "ğŸ“Š æŠ“å–ä¸ç¿»è¯‘ç»“æœ"
          echo "=================="
          
          if [ -f "å•†å“æ•°æ®.json" ]; then
              python << 'EOF'
          import json
          with open('å•†å“æ•°æ®.json', 'r', encoding='utf-8') as f:
              æ•°æ® = json.load(f)
          
          åŸºæœ¬ä¿¡æ¯ = æ•°æ®.get('åŸºæœ¬ä¿¡æ¯', {})
          ä»·æ ¼ä¿¡æ¯ = æ•°æ®.get('ä»·æ ¼ä¿¡æ¯', {})
          
          print("âœ… æŠ“å–ä¸ç¿»è¯‘æˆåŠŸï¼")
          print("")
          print("ğŸ“¦ å•†å“ä¿¡æ¯:")
          print(f"   ä¸­æ–‡æ ‡é¢˜: {åŸºæœ¬ä¿¡æ¯.get('ä¸­æ–‡æ ‡é¢˜', 'æ— ')}")
          print(f"   ä¼˜åŒ–è‹±æ–‡: {åŸºæœ¬ä¿¡æ¯.get('ä¼˜åŒ–è‹±æ–‡æ ‡é¢˜', 'æ— ')}")
          print(f"   ç›®æ ‡å¸‚åœº: {åŸºæœ¬ä¿¡æ¯.get('ç›®æ ‡å¸‚åœº', 'æ— ')}")
          print(f"   MOQ: {åŸºæœ¬ä¿¡æ¯.get('æœ€å°èµ·è®¢é‡', 0)}")
          print("")
          
          print("ğŸ’° ä»·æ ¼ä¿¡æ¯:")
          æ­¥éª¤ = ä»·æ ¼ä¿¡æ¯.get('è®¡ç®—æ­¥éª¤', {})
          for æ­¥éª¤å, æ­¥éª¤å€¼ in æ­¥éª¤.items():
              print(f"   {æ­¥éª¤å€¼}")
          print(f"   æœ€ç»ˆç¾å…ƒä»·æ ¼: ${ä»·æ ¼ä¿¡æ¯.get('ç¾å…ƒä»·æ ¼', 0):.2f}")
          print("")
          
          print("ğŸ“ å•†å“è¯¦æƒ…:")
          è¯¦æƒ… = æ•°æ®.get('å•†å“è¯¦æƒ…', {})
          print(f"   å›¾ç‰‡æ•°é‡: {è¯¦æƒ….get('å›¾ç‰‡æ•°é‡', 0)}")
          print(f"   è§„æ ¼å‚æ•°: {è¯¦æƒ….get('å‚æ•°æ•°é‡', 0)} é¡¹")
          
          è§„æ ¼ = è¯¦æƒ….get('è§„æ ¼å‚æ•°', {})
          if è§„æ ¼:
              print("   ç¿»è¯‘åè§„æ ¼:")
              for é”®, å€¼ in list(è§„æ ¼.items())[:3]:
                  print(f"     - {é”®}: {å€¼}")
          EOF
          else
              echo "âŒ æŠ“å–ç»“æœæ–‡ä»¶ä¸å­˜åœ¨"
          fi
          
      - name: 8. ä¿å­˜ç»“æœæ–‡ä»¶
        uses: actions/upload-artifact@v4  # è¿™é‡Œæ”¹ä¸º v4
        with:
          name: å•†å“æ•°æ®-ç¿»è¯‘ç‰ˆ
          path: å•†å“æ•°æ®.json
          retention-days: 30
          
      - name: 9. ä»»åŠ¡å®Œæˆ
        run: |
          echo "âœ… æŠ“å–ä¸ç¿»è¯‘ä»»åŠ¡å®Œæˆï¼"
          echo "ğŸ“ ç»“æœå·²ä¿å­˜ä¸ºArtifact"
